<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaze Scroll</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <!-- 최상단 알림 메시지 -->
    <div id="topNotification" class="top-notification">
      <span id="notificationText"
        >시선 추적이 시작되었습니다! 이제 눈을 움직여서 스크롤해보세요.</span
      >
      <span
        style="width: 100%; margin-left: 10px; font-size: 12px; opacity: 0.8"
        >✕</span
      >
    </div>

    <div class="container">
      <!-- 왼쪽: 메인 컨트롤 -->
      <div class="main-controls">
        <h1>👁️ Gaze Scroll</h1>

        <div class="status-indicator">
          <div class="status-dot" id="statusDot"></div>
          <div class="status-text" id="statusText">준비 중...</div>
        </div>

        <div class="controls">
          <div class="control-group">
            <h3>시선 추적</h3>
            <div class="button-group">
              <button class="toggle-btn" id="toggleBtn">시선 추적 시작</button>
              <button class="calibration-btn" id="calibrateBtn">
                눈 위치 보정
              </button>
            </div>
          </div>

          <div class="control-group">
            <h3>스크롤 설정</h3>
            <div class="settings">
              <div class="setting-item">
                <span class="setting-label">스크롤 속도</span>
                <input
                  type="number"
                  class="setting-input"
                  id="scrollSpeed"
                  value="50"
                  min="10"
                  max="200"
                  step="10"
                />
              </div>
              <div class="setting-item">
                <span class="setting-label">상단 영역 (%)</span>
                <input
                  type="number"
                  class="setting-input"
                  id="topZone"
                  value="30"
                  min="10"
                  max="45"
                  step="5"
                />
              </div>
              <div class="setting-item">
                <span class="setting-label">하단 영역 (%)</span>
                <input
                  type="number"
                  class="setting-input"
                  id="bottomZone"
                  value="30"
                  min="10"
                  max="45"
                  step="5"
                />
              </div>
              <!-- 디버그 모드 체크 박스 제거됨 - 항상 디버그 모드로 작동 -->
            </div>
          </div>
        </div>

        <div class="info-text">
          화면 상단을 바라보면 위로 스크롤,<br />
          하단을 바라보면 아래로 스크롤됩니다.<br /><br />
          <small style="font-size: 11px; color: rgba(255, 255, 255, 0.6)">
            ※ 카메라 권한 오류 시: 주소창 왼쪽 카메라 아이콘 클릭하여 허용
          </small>
        </div>
      </div>

      <!-- 오른쪽: 카메라 패널 -->
      <div class="debug-panel-container" id="debugPanelContainer">
        <!-- 카메라 패널 -->
        <div
          class="debug-panel"
          id="debugPanel"
          style="height: 100%; display: flex; flex-direction: column"
        >
          <!-- 카메라 영역 (상단) -->
          <div class="camera-section" style="flex-shrink: 0">
            <!-- 카메라 영역 -->
            <div>
              <div
                style="
                  padding: 8px;
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 8px;
                  margin-bottom: 10px;
                  text-align: center;
                "
              >
                <h4 style="margin: 0; color: #74b9ff; font-size: 12px">
                  📹 실시간 카메라
                </h4>
                <div
                  style="
                    font-size: 10px;
                    color: rgba(255, 255, 255, 0.6);
                    margin-top: 4px;
                  "
                >
                  디버그 모드에서 얼굴 감지 정보 표시
                </div>
              </div>
              <div
                class="debug-video-container"
                style="
                  position: relative;
                  width: 100%;
                  height: 165px;
                  background: rgba(0, 0, 0, 0.5);
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  overflow: hidden;
                  border: 1px solid rgba(255, 255, 255, 0.1);
                  pointer-events: auto;
                "
              >
                <video
                  id="debugVideo"
                  autoplay
                  playsinline
                  muted
                  style="
                    width: 100% !important;
                    height: 100% !important;
                    border-radius: 8px;
                    background: #000;
                    object-fit: cover;
                    display: block;
                    position: relative;
                    z-index: 1;
                  "
                ></video>
                <!-- 카메라 로딩 중 표시 -->
                <div
                  id="cameraLoading"
                  style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    color: rgba(255, 255, 255, 0.9);
                    font-size: 11px;
                    text-align: center;
                    pointer-events: none;
                    background: rgba(0, 0, 0, 0.8);
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-weight: bold;
                    z-index: 1000;
                    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
                  "
                >
                  📹 로딩...
                </div>

                <!-- 카메라 권한 재요청 버튼 -->
                <button
                  id="retryCameraBtn"
                  style="
                    position: absolute;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%) translateY(0);
                    background: linear-gradient(
                      135deg,
                      rgba(116, 185, 255, 0.9) 0%,
                      rgba(52, 152, 219, 0.9) 100%
                    );
                    color: white;
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 8px;
                    padding: 10px 20px;
                    font-size: 12px;
                    cursor: pointer;
                    display: none;
                    font-weight: bold;
                    opacity: 0;
                    transition: all 0.3s ease;
                    z-index: 1500;
                    pointer-events: auto;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3),
                      0 0 0 0 rgba(52, 152, 219, 0.4);
                    animation: buttonPulse 2s infinite;
                  "
                >
                  🔄 카메라 권한 재시도
                </button>
                <canvas
                  id="debugCanvas"
                  style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    pointer-events: none;
                  "
                ></canvas>
              </div>
            </div>
          </div>

          <!-- 디버그 정보 영역 (하단) -->
          <div
            class="debug-info-section"
            style="
              flex: 1;
              overflow: hidden;
              display: flex;
              flex-direction: column;
            "
          >
            <div
              class="debug-info"
              style="
                flex: 1;
                overflow-y: auto;
                max-height: none;
                padding: 8px 0;
              "
            >
              <!-- 얼굴 감지 상태 -->
              <div class="debug-section">
                <div class="metric-item">
                  <span class="metric-label">얼굴 감지:</span>
                  <span class="metric-value" id="faceDetectionStatus"
                    >대기중</span
                  >
                </div>
                <div class="metric-item">
                  <span class="metric-label">눈 추적 품질:</span>
                  <span class="metric-value" id="eyeTrackingQuality">0.0</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">피부톤 픽셀:</span>
                  <span class="metric-value" id="skinPixels">0/0 (0%)</span>
                </div>
              </div>

              <!-- 시선 및 밝기 정보 -->
              <div class="debug-section">
                <div class="metric-item">
                  <span class="metric-label">시선 위치:</span>
                  <span class="metric-value" id="gazePosition">중앙</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">밝기 차이:</span>
                  <span class="metric-value" id="brightnessDiff">0.00</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">상단 밝기:</span>
                  <span class="metric-value" id="topBrightness">0.00</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">하단 밝기:</span>
                  <span class="metric-value" id="bottomBrightness">0.00</span>
                </div>
              </div>

              <!-- 스크롤 정보 -->
              <div class="debug-section">
                <div class="metric-item">
                  <span class="metric-label">스크롤 방향:</span>
                  <span class="metric-value" id="scrollDirection">정지</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">가속도:</span>
                  <span class="metric-value" id="acceleration">0.0</span>
                </div>
              </div>

              <!-- 캘리브레이션 및 추적 정보 -->
              <div class="debug-section">
                <div class="metric-item">
                  <span class="metric-label">캘리브레이션:</span>
                  <span class="metric-value" id="calibrationProgress"
                    >0/30</span
                  >
                </div>
                <div class="metric-item">
                  <span class="metric-label">눈 간 거리:</span>
                  <span class="metric-value" id="eyeDistance">0px</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">왼쪽 눈 신뢰도:</span>
                  <span class="metric-value" id="leftEyeConfidence">0.0</span>
                </div>
                <div class="metric-item">
                  <span class="metric-label">오른쪽 눈 신뢰도:</span>
                  <span class="metric-value" id="rightEyeConfidence">0.0</span>
                </div>
              </div>

              <!-- 컨트롤 영역 -->
              <div class="debug-controls">
                <div class="metric-item">
                  <span class="metric-label">해상도:</span>
                  <span class="metric-value" id="zoomValue"
                    >1배율 (640x480)</span
                  >
                </div>
                <div class="metric-item">
                  <label style="display: flex; align-items: center; gap: 8px">
                    <input type="checkbox" id="mirrorMode" style="margin: 0" />
                    <span class="metric-label">좌우 반전</span>
                  </label>
                </div>
                <div
                  class="metric-item"
                  style="grid-column: 1 / -1; justify-content: center"
                >
                  <button
                    id="recenterEyes"
                    style="
                      padding: 6px 12px;
                      font-size: 11px;
                      background: #667eea;
                      color: white;
                      border: none;
                      border-radius: 6px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    눈 중앙 맞추기
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="popup.js"></script>
  </body>
</html>
